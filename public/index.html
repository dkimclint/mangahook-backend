<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Favorite Manhwa</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: sans-serif; margin:0; padding:0; }
    header, footer { text-align:center; padding:1rem; background:#eee; }
    .grid { display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; }
    .card, .chapter { border:1px solid #ccc; padding:1rem; border-radius:5px; text-align:center; }
    .card img, .chapter img { max-width:100%; border-radius:5px; }
    #chapters-container { max-height:80vh; overflow-y:auto; display:flex; flex-direction:column; gap:1rem; padding:1rem; }
    button { cursor:pointer; padding:.5rem 1rem; margin-top:0.5rem; }
  </style>
</head>
<body>
  <header>
    <h1>üìö My Favorite Manhwa</h1>
    <p>Click a manga to see all chapters</p>
  </header>

  <main>
    <section id="manga-list">
      <h2>My Manhwa</h2>
      <div id="manga-container" class="grid"></div>
    </section>

    <section id="chapter-list" style="display:none;">
      <h2 id="chapter-title">Chapters</h2>
      <div id="chapters-container"></div>
      <button id="back-btn">‚¨ÖÔ∏è Back to Manga List</button>
    </section>
  </main>

  <footer>
    <p>Powered by Mock Backend üöÇ</p>
  </footer>

  <script>
    const BASE_URL = window.location.origin;

    const mangaContainer = document.getElementById("manga-container");
    const chaptersSection = document.getElementById("chapter-list");
    const chaptersContainer = document.getElementById("chapters-container");
    const backBtn = document.getElementById("back-btn");
    const chapterTitle = document.getElementById("chapter-title");

    let allChapters = [];
    let currentIndex = 0;
    const CHUNK_SIZE = 20;

    // Load manga list
    function loadMangaList() {
      fetch(`${BASE_URL}/api/mangaList`)
        .then(res => res.json())
        .then(data => {
          mangaContainer.innerHTML = "";
          data.mangaList.forEach(manga => {
            const card = document.createElement("div");
            card.classList.add("card");
            card.innerHTML = `
              <img src="${manga.image}" alt="${manga.title}">
              <h3>${manga.title}</h3>
              <p>${manga.description}</p>
              <p><strong>${manga.view} views</strong></p>
              <button class="view-chapters" data-id="${manga.id}">View Chapters</button>
            `;
            mangaContainer.appendChild(card);
          });

          document.querySelectorAll(".view-chapters").forEach(btn => {
            btn.addEventListener("click", e => {
              const id = e.target.getAttribute("data-id");
              loadChapters(id);
            });
          });
        });
    }

    // Load chapters
    function loadChapters(mangaId) {
      fetch(`${BASE_URL}/api/manga/${mangaId}/chapters`)
        .then(res => res.json())
        .then(data => {
          allChapters = data.chapters;
          currentIndex = 0;
          chaptersContainer.innerHTML = "";
          loadMoreChapters();
          document.getElementById("manga-list").style.display = "none";
          chaptersSection.style.display = "block";
          chapterTitle.textContent = `Chapters for Demon Magic Emperor`;
        });
    }

    // Load more chapters for lazy loading
    function loadMoreChapters() {
      const chunk = allChapters.slice(currentIndex, currentIndex + CHUNK_SIZE);
      chunk.forEach(chapter => {
        const div = document.createElement("div");
        div.classList.add("chapter");
        div.innerHTML = `
          <h4>${chapter.chapter}</h4>
          <a href="${chapter.url}" target="_blank">
            <img src="${chapter.image}" alt="${chapter.chapter}" class="chapter-image">
          </a>
        `;
        chaptersContainer.appendChild(div);
      });
      currentIndex += CHUNK_SIZE;
    }

    // Detect scroll for lazy loading
    chaptersContainer.addEventListener("scroll", () => {
      if (chaptersContainer.scrollTop + chaptersContainer.clientHeight >= chaptersContainer.scrollHeight) {
        loadMoreChapters();
      }
    });

    // Back button
    backBtn.addEventListener("click", () => {
      chaptersSection.style.display = "none";
      document.getElementById("manga-list").style.display = "block";
    });

    window.onload = () => loadMangaList();
  </script>
</body>
</html>
